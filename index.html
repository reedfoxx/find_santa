<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ó–Ω–∞–π–¥–∏ –°–∞–Ω—Ç—É ‚Äî –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è</title>
<style>
  :root{
    --bg:#071029;
    --panel:#0f1724cc;
    --accent:#ffd166;
    --text:#f8f9fa;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text)}
  .wrap{max-width:1100px;margin:18px auto;padding:12px;height:calc(100% - 36px);display:flex;flex-direction:column;gap:12px}
  .top{
    display:flex;gap:12px;align-items:center;padding:12px;border-radius:12px;background:linear-gradient(90deg,#07122a88,#0b203688);
  }
  .title{font-weight:700;font-size:18px}
  .controls{margin-left:auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  input[type=number],select,button{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:var(--text)}
  button.primary{background:linear-gradient(180deg,#ffd166,#ffb703);border:none;color:#101010;font-weight:700;padding:8px 12px}
  .info{display:flex;gap:12px;align-items:center;padding:10px 12px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border-radius:10px}
  .play {
    position:relative;
    flex:1;
    border-radius:12px;
    overflow:hidden;
    background: radial-gradient(800px 300px at 10% 10%, #0f2433 0%, rgba(6,16,25,1) 40%, #06111a 100%);
    padding:8px;
    min-height:320px;
  }
  .emoji {
    position:absolute;
    user-select:none;
    touch-action:manipulation;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:transform .14s ease,opacity .18s;
    will-change:transform;
    background:transparent;
    border:none;
    padding:4px;
    line-height:1;
  }
  .emoji:hover{transform:translateY(-6px) scale(1.06)}
  .emoji.found{opacity:0.28; transform:scale(.85); filter:grayscale(.2); pointer-events:none}
  /* win overlay */
  .overlay{
    position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(4,8,14,0.6);z-index:9999;backdrop-filter:blur(3px)
  }
  .overlay.show{display:flex}
  .win{
    background:linear-gradient(135deg,#0b1220,#122033);padding:28px 34px;border-radius:18px;border:1px solid rgba(255,255,255,0.04);text-align:center;color:var(--text);box-shadow:0 20px 60px rgba(0,0,0,0.6)
  }
  .win h2{font-size:26px;margin:0 0 6px;background:linear-gradient(90deg,#ffe08a,#fff1c2);-webkit-background-clip:text;color:transparent}
  .win p{margin:8px 0 18px;color:#cfe0ff}
  .win button{padding:10px 16px;border-radius:10px;border:none;background:#ffd166;color:#081018;font-weight:700}
  .footer{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;font-size:13px;opacity:.85}
  @media(max-width:720px){
    .top{flex-direction:column;align-items:flex-start}
    .controls{margin-left:0}
    .win{width:86%}
  }
</style>
</head>
<body>
  <div class="wrap" role="application">
    <div class="top" aria-hidden="false">
      <div class="title">üéÑ –ì—Ä–∞ ‚Äî –ó–Ω–∞–π–¥–∏ –°–∞–Ω—Ç—É</div>
      <div class="controls" role="toolbar" aria-label="–ö–µ—Ä—É–≤–∞–Ω–Ω—è –≥—Ä–æ—é">
        <label>
          –©–æ —à—É–∫–∞—Ç–∏:
          <select id="targetSelect" aria-label="–û–±—Ä–∞—Ç–∏ —Ü—ñ–ª—å">
            <option value="üéÖ">–°–∞–Ω—Ç–∞ üéÖ</option>
            <option value="‚õÑ">–°–Ω—ñ–≥–æ–≤–∏–∫ ‚õÑ</option>
            <option value="üéÑ">–Ø–ª–∏–Ω–∫–∞ üéÑ</option>
            <option value="üéÅ">–ü–æ–¥–∞—Ä—É–Ω–æ–∫ üéÅ</option>
          </select>
        </label>

        <label>–¶—ñ–ª—å (–∫—ñ–ª—å–∫—ñ—Å—Ç—å):
          <input id="targetCount" type="number" min="1" max="50" value="5" />
        </label>

        <label>–í—Å—å–æ–≥–æ:
          <input id="totalCount" type="number" min="5" max="200" value="50" />
        </label>

        <button id="startBtn" class="primary">–°—Ç–∞—Ä—Ç</button>
      </div>
    </div>

    <div class="info">
      <div>–ü–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞–π—Ç–∏: <strong id="remaining">0</strong> <span id="previewEmoji">üéÖ</span></div>
      <div style="margin-left:auto">–ü–æ—Ä–∞–¥–∞: —Ç–æ—Ä–∫–∞–π—Å—è/–∫–ª—ñ–∫–∞–π –ø–æ –µ–º–æ–¥–∑—ñ</div>
    </div>

    <div class="play" id="playArea" aria-label="–Ü–≥—Ä–æ–≤–µ –ø–æ–ª–µ">
      <div class="overlay" id="overlay" role="dialog" aria-modal="true">
        <div class="win" role="document">
          <h2 id="winTitle">–í—ñ—Ç–∞—é! üéâ</h2>
          <p id="winText">–¢–∏ –∑–Ω–∞–π—à–æ–≤ —É—Å—ñ —Ü—ñ–ª—å–æ–≤—ñ –µ–º–æ–¥–∑—ñ.</p>
          <button id="replayBtn">–ì—Ä–∞—Ç–∏ —â–µ —Ä–∞–∑</button>
        </div>
      </div>
    </div>

<div class="footer"><a href="https://reedfoxx.github.io/main/" target="_blank" rel="noopener" style="color: #ffffff; text-decoration: underline;">–í—ñ–¥–≤—ñ–¥–∞—Ç–∏ —Å–∞–π—Ç</a>
</div>
  </div>

<script>
(function(){
  const playArea = document.getElementById('playArea');
  const startBtn = document.getElementById('startBtn');
  const replayBtn = document.getElementById('replayBtn');
  const targetSelect = document.getElementById('targetSelect');
  const targetCountInput = document.getElementById('targetCount');
  const totalCountInput = document.getElementById('totalCount');
  const remainingEl = document.getElementById('remaining');
  const previewEmoji = document.getElementById('previewEmoji');
  const overlay = document.getElementById('overlay');
  const winTitle = document.getElementById('winTitle');
  const winText = document.getElementById('winText');

  // –±–∞–∑–æ–≤–∏–π –Ω–∞–±—ñ—Ä —Å–≤—è—Ç–∫–æ–≤–∏—Ö –µ–º–æ–¥–∑—ñ
  const pools = ['üéÖ','‚õÑ','üéÑ','üéÅ','‚ú®','‚ùÑÔ∏è','üîî','‚≠ê','üß¶','üß£','üß∏','üç¨'];

  let state = {
    targetEmoji: 'üéÖ',
    targetCount: 5,
    totalCount: 50,
    found: 0,
    placements: [] // –º–∞—Å–∏–≤ DOMRect –∑–∞–Ω—è—Ç–∏—Ö –∑–æ–Ω
  };

  // —É—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫—ñ–≤ –∑ –±—É—Ñ–µ—Ä–æ–º gap
  function rectOverlap(a,b,gap=10){
    return !(a.right + gap < b.left || a.left > b.right + gap || a.bottom + gap < b.top || a.top > b.bottom + gap);
  }

  // —Å—Ç–≤–æ—Ä—é—î DOM-–µ–ª–µ–º–µ–Ω—Ç (–Ω–µ–≤–∏–¥–∏–º–∏–π) —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ä–æ–∑–º—ñ—Ä–∏
  function createMeasureElement(emoji, fontSizePx){
    const el = document.createElement('div');
    el.className = 'emoji';
    el.style.position = 'absolute';
    el.style.left = '-9999px';
    el.style.top = '-9999px';
    el.style.fontSize = (fontSizePx || 40) + 'px';
    el.textContent = emoji;
    el.setAttribute('aria-hidden','true');
    document.body.appendChild(el);
    const rect = el.getBoundingClientRect();
    return {el, rect};
  }

  // –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ –µ–ª–µ–º–µ–Ω—Ç —É –ø–æ–ª—ñ –±–µ–∑ –ø–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è; –ø–æ–≤–µ—Ä—Ç–∞—î –µ–ª–µ–º–µ–Ω—Ç (–ø–æ–∑–∏—Ü—ñ–π–æ–≤–∞–Ω–∏–π)
  function placeElement(emoji, isTarget, maxAttempts=700){
    const areaRect = playArea.getBoundingClientRect();
    // –±–∞–∑–æ–≤–∏–π —Ä–æ–∑–º—ñ—Ä —Ç–∞ –≤–∞—Ä—ñ–∞—Ü—ñ—è –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø–ª–æ—â—ñ
    const baseMin = Math.max(24, Math.round(Math.min(areaRect.width, areaRect.height) * 0.05));
    const baseMax = Math.max(baseMin+8, Math.round(Math.min(areaRect.width, areaRect.height) * 0.12));
    let fontSize = Math.floor(baseMin + Math.random() * (baseMax - baseMin));

    // —Å—Ç–≤–æ—Ä–∏–º–æ –µ–ª–µ–º–µ–Ω—Ç —É DOM (—Ç–∏–º—á–∞—Å–æ–≤–æ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π) —â–æ–± –≤–∏–º—ñ—Ä—è—Ç–∏ —Ç–æ—á–Ω–∏–π —Ä–æ–∑–º—ñ—Ä
    const m = createMeasureElement(emoji, fontSize);
    const el = m.el;
    let rect = m.rect;

    // –¥–æ–¥–∞–º–æ –¥–æ playArea, –∞–ª–µ –ø–æ–∫–∏ –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ ‚Äî –ø–æ—Å—Ç–∞–≤–∏–º–æ —Ç–∏–º—á–∞—Å–æ–≤–æ –≤ 0,0
    el.style.left = '0px';
    el.style.top = '0px';
    playArea.appendChild(el);

    let attempts = 0;
    let placed = false;
    while(attempts < maxAttempts && !placed){
      attempts++;
      // –≤–∏–ø–∞–¥–∫–æ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è –≤ –º–µ–∂–∞—Ö –æ–±–ª–∞—Å—Ç—ñ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ä–æ–∑–º—ñ—Ä—É
      const maxX = Math.max(0, areaRect.width - rect.width - 6);
      const maxY = Math.max(0, areaRect.height - rect.height - 6);
      const x = Math.round( Math.random() * maxX );
      const y = Math.round( Math.random() * maxY );

      el.style.left = x + 'px';
      el.style.top = y + 'px';

      // –æ–Ω–æ–≤–∏–º–æ rect –≤—ñ–¥–Ω–æ—Å–Ω–æ viewport
      rect = el.getBoundingClientRect();

      // –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è –∑ —É–∂–µ —Ä–æ–∑–º—ñ—â–µ–Ω–∏–º–∏
      let overlap = state.placements.some(existing => rectOverlap(rect, existing, 12));
      if (!overlap){
        // —É—Å–ø—ñ—à–Ω–æ —Ä–æ–∑–º—ñ—â–µ–Ω–æ
        state.placements.push(rect);
        placed = true;
        break;
      } else {
        // –ø—Ä–æ–±—É—î–º–æ —ñ–Ω—à—É –ø–æ–∑–∏—Ü—ñ—é
      }
    }

    if (!placed){
      // —è–∫—â–æ –Ω–µ –∑–Ω–∞–π—à–ª–æ—Å—è –º—ñ—Å—Ü—è ‚Äî –∑–º–µ–Ω—à—É—î–º–æ –µ–ª–µ–º–µ–Ω—Ç —ñ –ø—Ä–æ–±—É—î–º–æ —â–µ —Ä–∞–∑
      fontSize = Math.max(14, Math.round(fontSize * 0.72));
      el.style.fontSize = fontSize + 'px';
      rect = el.getBoundingClientRect();

      // —â–µ –æ–¥–Ω–∞ —Å–µ—Ä—ñ—è —Å–ø—Ä–æ–±
      let tries2 = 0;
      while(tries2 < 800 && !placed){
        tries2++;
        const maxX = Math.max(0, areaRect.width - rect.width - 6);
        const maxY = Math.max(0, areaRect.height - rect.height - 6);
        const x = Math.round( Math.random() * maxX );
        const y = Math.round( Math.random() * maxY );
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        rect = el.getBoundingClientRect();
        let overlap = state.placements.some(existing => rectOverlap(rect, existing, 8));
        if (!overlap){
          state.placements.push(rect);
          placed = true;
          break;
        }
      }
    }

    // —è–∫—â–æ —Ç–∞–∫ —ñ –Ω–µ —Ä–æ–∑–º—ñ—â–µ–Ω–æ ‚Äî –∑–∞–ª–∏—à–∞—î–º–æ –Ω–∞ –≤–∏–ø–∞–¥–∫–æ–≤–æ–º—É –º—ñ—Å—Ü—ñ (–æ—Å—Ç–∞–Ω–Ω—ñ–π —à–∞–Ω—Å)
    if (!placed){
      const x = Math.max(0, Math.round(Math.random() * Math.max(0, areaRect.width - rect.width)));
      const y = Math.max(0, Math.round(Math.random() * Math.max(0, areaRect.height - rect.height)));
      el.style.left = x + 'px';
      el.style.top = y + 'px';
      rect = el.getBoundingClientRect();
      state.placements.push(rect);
    }

    // –Ω–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ –∞—Ç—Ä–∏–±—É—Ç–∏ —ñ —Å–ª—É—Ö–∞—á—ñ
    el.dataset.emoji = emoji;
    if (isTarget){
      el.dataset.target = '1';
      el.setAttribute('aria-label','–¶—ñ–ª—å–æ–≤–µ –µ–º–æ–¥–∑—ñ');
      el.addEventListener('click', onTargetClick);
      el.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') onTargetClick.call(el,e); });
      el.tabIndex = 0;
    } else {
      el.dataset.target = '0';
      el.setAttribute('aria-label','–ï–º–æ–¥–∑—ñ');
    }

    return el;
  }

  function onTargetClick(e){
    // this –ø—Ä–∏–≤'—è–∑–∞–Ω–æ –¥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
    const el = this;
    if (el.dataset.clicked === '1') return;
    el.dataset.clicked = '1';
    el.classList.add('found');
    state.found++;
    remainingEl.textContent = Math.max(0, state.targetCount - state.found);
    // –∑–≤—É–∫–æ–≤–∏–π –∞–±–æ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π —Ñ—ñ–¥–±–µ–∫ –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ —Ç—É—Ç
    if (state.found >= state.targetCount){
      // –ø–µ—Ä–µ–º–æ–≥–∞
      setTimeout(()=> showWin(), 250);
    }
  }

  function clearField(){
    // –≤–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ –µ–º–æ–¥–∑—ñ —Ç–∞ —Å–∫–∏–¥–∞—î–º–æ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è
    playArea.querySelectorAll('.emoji').forEach(n => n.remove());
    state.placements = [];
    state.found = 0;
  }

  function generateAll(){
    clearField();
    const areaRect = playArea.getBoundingClientRect();
    if (areaRect.width === 0 || areaRect.height === 0){
      // —è–∫—â–æ —â–µ –Ω–µ –≤—ñ–¥–º–∞–ª—å–æ–≤–∞–Ω–æ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø—Ä–∏ —à–≤–∏–¥–∫–æ–º—É —Å—Ç–∞—Ä—Ç—ñ), –∑–∞—á–µ–∫–∞—î–º–æ –º—ñ–∫—Ä–æ—Ü–∏–∫–ª
      setTimeout(generateAll, 60);
      return;
    }

    // 1) –°–ø–æ—á–∞—Ç–∫—É ‚Äî —Ü—ñ–ª—å–æ–≤—ñ –µ–º–æ–¥–∑—ñ
    for (let i=0;i<state.targetCount;i++){
      placeElement(state.targetEmoji, true);
    }

    // 2) –ü–æ—Ç—ñ–º ‚Äî —ñ–Ω—à—ñ –µ–º–æ–¥–∑—ñ, —É–Ω–∏–∫–∞—é—á–∏ –ø–æ—Ç–æ—á–Ω–∏—Ö –∑–∞–Ω—è—Ç—å
    // –≤–∏–∑–Ω–∞—á–∏–º–æ —Å–∫—ñ–ª—å–∫–∏ –≤—Å—å–æ–≥–æ —Å—Ç–∞–≤–∏—Ç–∏ (–Ω–µ –º–µ–Ω—à–µ –Ω—ñ–∂ targetCount)
    const total = Math.max(state.totalCount, state.targetCount);
    const distractorCount = Math.max(0, total - state.targetCount);

    // —Å–∫–ª–∞–¥–∞—î–º–æ –ø—É–ª –≤—ñ–¥–≤–æ–ª—ñ–∫–∞—é—á–∏—Ö –µ–º–æ–¥–∑—ñ (–±–µ–∑ —Ü—ñ–ª—ñ)
    const pool = pools.filter(p => p !== state.targetEmoji);

    for (let i=0;i<distractorCount;i++){
      const pick = pool[Math.floor(Math.random()*pool.length)];
      placeElement(pick, false);
    }

    // –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –¥—Ä—ñ–±–Ω—ñ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ñ –µ–º–æ–¥–∑—ñ, —â–æ–± –≤–∏–≥–ª—è–¥ –±—É–ª–æ –≥—É—Å—Ç—ñ—à–∏–º (–∞–ª–µ –Ω–µ –ø–µ—Ä–µ–∫—Ä–∏–≤–∞–ª–∏)
    const extra = Math.max(0, Math.min(30, Math.floor(state.totalCount * 0.15)));
    for (let i=0;i<extra;i++){
      const pick = pools[Math.floor(Math.random()*pools.length)];
      placeElement(pick, false);
    }

    remainingEl.textContent = state.targetCount - state.found;
  }

  function showWin(){
    winTitle.textContent = '–í—ñ—Ç–∞—é! üéâ';
    winText.textContent = `–¢–∏ –∑–Ω–∞–π—à–æ–≤ –≤—Å—ñ ${state.targetCount} ${state.targetEmoji}`;
    overlay.classList.add('show');
  }

  function startGame(){
    // –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
    state.targetEmoji = targetSelect.value || 'üéÖ';
    state.targetCount = Math.max(1, Math.min(50, parseInt(targetCountInput.value) || 5));
    state.totalCount  = Math.max( state.targetCount, Math.min(200, parseInt(totalCountInput.value) || 50) );
    previewEmoji.textContent = state.targetEmoji;
    remainingEl.textContent = state.targetCount;
    overlay.classList.remove('show');
    // —Ç—Ä–æ—Ö–∏ –∑–∞—á–µ–∫–∞—î–º–æ —â–æ–± layout –æ–Ω–æ–≤–∏–≤—Å—è –Ω–∞ –≤–∏–ø–∞–¥–∫—É –º–æ–±—ñ–ª—å–Ω–∏—Ö / —Ä–µ—Å–∞–π–∑—É
    setTimeout(generateAll, 60);
  }

  // –∫–Ω–æ–ø–∫–∏
  startBtn.addEventListener('click', startGame);
  replayBtn.addEventListener('click', startGame);
  // —Ç–∞–∫–æ–∂ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
  window.addEventListener('load', ()=> {
    // –Ω–µ–≤–µ–ª–∏–∫–∞ –ø–∞—É–∑–∞, —â–æ–± –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—ñ–¥–º–∞–ª—å–æ–≤—É–≤–∞–≤—Å—è
    setTimeout(startGame, 220);
  });

  // –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É ‚Äî —Ä–µ–≥–µ–Ω–µ—Ä—É—î–º–æ, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–µ—Ä–µ–∫—Ä–∏—Ç—Ç—ñ–≤ –ø—Ä–∏ –Ω–æ–≤–æ–º—É —Ä–æ–∑–º—ñ—Ä—ñ
  let rTimer;
  window.addEventListener('resize', ()=>{
    clearTimeout(rTimer);
    rTimer = setTimeout(()=>{
      // —è–∫—â–æ —î –µ–º–æ–¥–∑—ñ ‚Äî —Ä–µ–≥–µ–Ω–µ—Ä—É—î–º–æ –∑ —Ç–∏–º–∏ –∂ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏
      if (playArea.querySelectorAll('.emoji').length) startGame();
    }, 350);
  });

})();
</script>
</body>
</html>

